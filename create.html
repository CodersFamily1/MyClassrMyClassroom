<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Online Classroom - Rooms</title>
<style>
body {
  margin:0;
  font-family:"Segoe UI", sans-serif;
  background:#e0f2fe;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  min-height:100vh;
  padding-top:50px;
}

/* Container with fade-in */
.container {
  background:#ffffff;
  padding:30px 25px;
  border-radius:16px;
  box-shadow:0 12px 28px rgba(0,0,0,0.12);
  width:400px;
  opacity:0;
  transform: translateY(-15px);
  animation: fadeInUp 0.8s forwards;
}

@keyframes fadeInUp {
  to { opacity:1; transform: translateY(0); }
}

h2 {
  text-align:center;
  color:#1e3a8a;
  margin-bottom:20px;
}

/* Inputs */
input {
  width:100%;
  padding:12px;
  margin:10px 0;
  border:1px solid #d1d5db;
  border-radius:8px;
  outline:none;
  font-size:14px;
  transition: 0.3s;
}

input:focus {
  border-color:#2563eb;
  box-shadow:0 2px 6px rgba(37,99,235,0.2);
}

/* Buttons */
button {
  width:100%;
  padding:12px;
  margin-top:12px;
  border:none;
  border-radius:8px;
  font-size:16px;
  cursor:pointer;
  transition: all 0.3s ease;
  font-weight:500;
}

/* Create Room */
#create-room-btn { background:#4f46e5; color:#fff; }
#create-room-btn:hover { background:#4338ca; transform: translateY(-2px); }

/* Copy Room ID */
.copy-btn { background:#2ecc71; color:#fff; }
.copy-btn:hover { background:#27ae60; transform: translateY(-2px); }

/* Logout buttons */
#logout-btn, #logout-btn-join { background:#e74c3c; color:#fff; }
#logout-btn:hover, #logout-btn-join:hover { background:#c0392b; transform: translateY(-2px); }

/* Join Room */
#join-room-btn { background:#4f46e5; color:#fff; }
#join-room-btn:hover { background:#4338ca; transform: translateY(-2px); }

/* Switch links */
.switch {
  text-align:center;
  margin-top:15px;
  font-size:14px;
  cursor:pointer;
  color:#2563eb;
  transition: color 0.3s;
}
.switch:hover { color:#1e40af; }
</style>
</head>
<body>
<div class="container" id="create-container">
  <h2>Create Room</h2>
  <input type="text" id="room-name" placeholder="Room Name" />
  <input type="password" id="room-password" placeholder="Room Password" />
  <button id="create-room-btn">Create Room</button>
  <button id="copy-room-id" class="copy-btn" style="display:none;">Copy Room ID</button>
  <div class="switch" id="go-join">Already have a room? Join</div>
  <button id="logout-btn">Logout</button>
</div>

<div class="container" id="join-container" style="display:none;">
  <h2>Join Room</h2>
  <input type="text" id="join-room-id" placeholder="Room ID" />
  <input type="text" id="join-username" placeholder="Your Name" />
  <input type="password" id="join-room-password" placeholder="Room Password" />
  <button id="join-room-btn">Join Room</button>
  <div class="switch" id="go-create">Don't have a room? Create</div>
  <button id="logout-btn-join">Logout</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDoc, doc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyA_cKg4aCmS2EUJhE8Baq-wQK26Smu7pxY",
  authDomain: "myclassroom-67acf.firebaseapp.com",
  projectId: "myclassroom-67acf",
  storageBucket: "myclassroom-67acf.appspot.com",
  messagingSenderId: "319313107001",
  appId: "1:319313107001:web:52e7f5ca05e8721dded5e8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const createContainer = document.getElementById("create-container");
const joinContainer = document.getElementById("join-container");
const copyBtn = document.getElementById("copy-room-id");

// Switch view
document.getElementById("go-join").addEventListener("click", () => {
  createContainer.style.display = "none";
  joinContainer.style.display = "block";
});
document.getElementById("go-create").addEventListener("click", () => {
  joinContainer.style.display = "none";
  createContainer.style.display = "block";
});

// Logout
const logoutBtns = [document.getElementById("logout-btn"), document.getElementById("logout-btn-join")];
logoutBtns.forEach(btn => {
  btn.addEventListener("click", async () => {
    await signOut(auth);
    alert("✅ Logged Out!");
    window.location.href = "login.html"; 
  });
});

// Check login status
onAuthStateChanged(auth, user => {
  if(!user){
    alert("❌ You must login first!");
    window.location.href = "login.html"; 
  }
});

// Create Room
document.getElementById("create-room-btn").addEventListener("click", async () => {
  const name = document.getElementById("room-name").value.trim();
  const password = document.getElementById("room-password").value.trim();
  if(!name || !password){ alert("Enter Room Name & Password!"); return; }

  try {
    const docRef = await addDoc(collection(db, "rooms"), {
      name, password, createdBy: auth.currentUser.uid, createdAt: new Date()
    });
    alert(`✅ Room Created! Your Room ID: ${docRef.id}`);

    // Show copy button
    copyBtn.style.display = "block";
    copyBtn.onclick = ()=> {
      navigator.clipboard.writeText(docRef.id);
      alert("Room ID Copied!");
    };

    // Redirect to whiteboard page after 1s
    setTimeout(()=> {
      window.location.href = `whiteboard.html?roomId=${docRef.id}&username=${auth.currentUser.displayName || 'User'}`;
    }, 1000);

  } catch(err){ alert("❌ " + err.message); }
});

// Join Room
document.getElementById("join-room-btn").addEventListener("click", async () => {
  const roomId = document.getElementById("join-room-id").value.trim();
  const username = document.getElementById("join-username").value.trim();
  const password = document.getElementById("join-room-password").value.trim();
  if(!roomId || !username || !password){ alert("Enter Room ID, Name & Password!"); return; }

  try {
    const roomDoc = await getDoc(doc(db, "rooms", roomId));
    if(!roomDoc.exists()){ alert("❌ Room not found!"); return; }
    const roomData = roomDoc.data();
    if(roomData.password !== password){ alert("❌ Wrong Room Password!"); return; }

    alert(`✅ Welcome ${username} to Room: ${roomData.name}`);
    window.location.href = `whiteboard.html?roomId=${roomId}&username=${username}`;
  } catch(err){ alert("❌ " + err.message); }
});
</script>
</body>
</html>